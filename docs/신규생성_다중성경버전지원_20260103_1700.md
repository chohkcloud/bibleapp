# 다중 성경 버전 지원 기능 추가

> 한글, 영어, 일본어 등 다국어 성경 버전 다운로드 및 전환 기능

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | 신규생성_다중성경버전지원_20260103_1700.md |
| 카테고리 | 신규생성 |
| 생성일시 | 2026-01-03 17:00 KST |
| 작성자 | Claude |
| 버전 | v1.1.0 |
| 위치 | `C:/claude/claudeproject/bibleapp/docs/신규생성_다중성경버전지원_20260103_1700.md` |

---

## 목차

1. [기능 개요](#1-기능-개요)
2. [신규 생성 파일](#2-신규-생성-파일)
3. [수정된 파일](#3-수정된-파일)
4. [지원 버전 목록](#4-지원-버전-목록)
5. [사용 방법](#5-사용-방법)
6. [기술 구현](#6-기술-구현)

---

## 1. 기능 개요

### 주요 기능
- 다국어 성경 버전 다운로드 (한글, 영어, 일본어)
- 공개 API (wldeh/bible-api) 활용
- 오프라인 사용을 위한 로컬 캐싱
- 버전 전환 및 관리

### 사용자 시나리오
1. 설정 > 성경 버전 터치
2. 버전 선택 화면에서 원하는 버전 다운로드
3. 다운로드 완료 후 해당 버전 선택
4. 성경 읽기 화면에서 선택한 버전 표시

---

## 2. 신규 생성 파일

### 2.1 서비스 레이어 (3개)

| 파일 | 경로 | 용도 |
|------|------|------|
| bibleApiService.ts | `src/services/` | 성경 API 통신 서비스 |
| bibleDownloadService.ts | `src/services/` | 다운로드 및 캐시 관리 |
| bibleVersionService.ts | `src/services/` | 버전 관리 통합 서비스 |

### 2.2 상태 관리 (1개)

| 파일 | 경로 | 용도 |
|------|------|------|
| downloadStore.ts | `src/store/` | 다운로드 진행 상태 관리 |

### 2.3 화면 (1개)

| 파일 | 경로 | 용도 |
|------|------|------|
| BibleVersionScreen.tsx | `src/screens/settings/` | 버전 선택/다운로드 UI |

### 2.4 데이터 (1개)

| 파일 | 경로 | 용도 |
|------|------|------|
| available.json | `src/data/versions/` | 지원 버전 메타데이터 |

---

## 3. 수정된 파일

| 파일 | 경로 | 변경 내용 |
|------|------|----------|
| database.ts | `src/types/` | 다중 버전 관련 타입 추가 |
| index.ts | `src/services/database/` | downloaded_versions 테이블 추가 |
| settingsStore.ts | `src/store/` | downloadedVersions, preferredVersionByLang 추가 |
| index.ts | `src/store/` | downloadStore export 추가 |
| index.ts | `src/services/` | 버전 서비스 export 추가 |
| types.ts | `src/navigation/` | BibleVersion 타입 추가 |
| SettingsStack.tsx | `src/navigation/` | BibleVersion 화면 추가 |
| SettingsScreen.tsx | `src/screens/settings/` | 버전 선택 화면 연결 |

---

## 4. 지원 버전 목록

| 버전 ID | 이름 | 언어 | 상태 | 비고 |
|---------|------|------|------|------|
| KRV | 개역한글 | 한국어 | 번들 | 기본 포함, 삭제 불가 |
| KJV | King James Version | English | 다운로드 | 공개 도메인 |
| ASV | American Standard Version | English | 다운로드 | 공개 도메인 |
| WEB | World English Bible | English | 다운로드 | 공개 도메인 |
| BSB | Berean Standard Bible | English | 다운로드 | 공개 도메인 |
| LSV | Literal Standard Version | English | 다운로드 | 공개 도메인 |
| DRA | Douay-Rheims American | English | 다운로드 | 공개 도메인 (가톨릭) |
| GNV | Geneva Bible | English | 다운로드 | 공개 도메인 (1599) |
| RV09 | Reina Valera 1909 | Español | 다운로드 | 공개 도메인 |
| LUTH | Lutherbibel 1912 | Deutsch | 다운로드 | 공개 도메인 |
| CUV | 和合本 | 中文 | 다운로드 | 공개 도메인 |

### 저작권 관련 참고

다음 버전들은 **저작권** 문제로 무료 API에서 제공되지 않습니다:
- **NIV** (New International Version): 저작권 보호
- **현대인의 성경**: 저작권 보호
- **메시지성경**: 저작권 보호
- **개역개정**: 대한성서공회 저작권

---

## 5. 사용 방법

### 5.1 버전 다운로드
1. 설정 화면에서 "성경 버전" 터치
2. "다운로드 가능" 섹션에서 원하는 버전의 "다운로드" 버튼 터치
3. 다운로드 진행률 확인 (70% 다운로드 + 30% DB 저장)
4. 완료 알림 확인

### 5.2 버전 전환
1. 버전 선택 화면에서 다운로드된 버전 터치
2. "사용 중" 뱃지 확인
3. 성경 읽기 화면에서 변경된 버전 확인

### 5.3 버전 삭제
1. 다운로드된 버전의 휴지통 아이콘 터치
2. 삭제 확인 알림에서 "삭제" 선택
3. 기본 버전(KRV)과 현재 사용 중인 버전은 삭제 불가

---

## 6. 기술 구현

### 6.1 API 서비스

```typescript
// bibleApiService.ts 핵심 메서드
class BibleApiService {
  getAvailableVersions(): BibleVersionInfo[];
  downloadFullBible(versionId, onProgress): Promise<BookData[]>;
  downloadChapter(versionId, bookId, chapter): Promise<ChapterData>;
  checkConnection(): Promise<boolean>;
}
```

**API 엔드포인트**: `https://cdn.jsdelivr.net/gh/wldeh/bible-api/bibles/`

### 6.2 다운로드 서비스

```typescript
// bibleDownloadService.ts 핵심 메서드
class BibleDownloadService {
  downloadVersion(versionId, onProgress): Promise<boolean>;
  cancelDownload(versionId): void;
  deleteVersion(versionId): Promise<boolean>;
  getDownloadedVersions(): Promise<string[]>;
  isVersionDownloaded(versionId): Promise<boolean>;
}
```

### 6.3 데이터베이스 스키마

```sql
-- 신규 테이블
CREATE TABLE downloaded_versions (
  bible_id TEXT PRIMARY KEY,
  downloaded_at TEXT NOT NULL,
  file_size INTEGER,
  verse_count INTEGER,
  is_bundled INTEGER DEFAULT 0,
  last_used_at TEXT
);
```

### 6.4 상태 관리

```typescript
// downloadStore.ts
interface DownloadState {
  activeDownloads: Record<string, DownloadProgress>;
  startDownload(versionId, totalBytes): void;
  updateProgress(versionId, progress): void;
  completeDownload(versionId): void;
  cancelDownload(versionId): void;
}

// settingsStore.ts 확장
interface SettingsState {
  downloadedVersions: string[];
  preferredVersionByLang: Record<string, string>;
  addDownloadedVersion(versionId): void;
  removeDownloadedVersion(versionId): void;
}
```

### 6.5 타입 정의

```typescript
// src/types/database.ts 추가 타입
interface BibleVersionInfo {
  id: string;
  name: string;
  nameLocal: string;
  language: string;
  languageName: string;
  copyright: string;
  size: number;
  verseCount: number;
  isDownloaded: boolean;
  isBundled: boolean;
  apiEndpoint?: string;
}

interface DownloadProgress {
  versionId: string;
  progress: number;
  downloadedBytes: number;
  totalBytes: number;
  status: DownloadStatus;
  error?: string;
}

type DownloadStatus =
  | 'pending' | 'downloading' | 'processing'
  | 'completed' | 'error' | 'cancelled';
```

---

## 관련 문서

- bibleapp_WBS.md - 작업 진행 관리
- 수정_커스텀헤더전체적용_20260103_1605.md - 이전 작업 (커스텀 헤더)

---

## 향후 개선 사항

1. 버전별 저작권 상세 정보 표시
2. 자동 업데이트 확인 기능
3. 저장 공간 관리 기능 (사용하지 않는 버전 자동 정리)
4. 저작권 성경 라이선스 검토 (NIV, 현대인의 성경 등)

---

## 버그 수정 이력

| 날짜 | 버전 | 내용 |
|------|------|------|
| 2026-01-03 17:00 | v1.0.0 | 초기 구현 |
| 2026-01-03 18:30 | v1.1.0 | API 응답 형식 파싱 버그 수정, 지원 버전 11개로 확장 (5개 언어) |
