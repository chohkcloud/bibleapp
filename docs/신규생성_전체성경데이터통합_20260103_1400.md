# 전체 성경 데이터 통합

> 개역한글 성경 66권 31,102절 데이터를 앱에 통합

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | 신규생성_전체성경데이터통합_20260103_1400.md |
| 카테고리 | 신규생성 |
| 생성일시 | 2026-01-03 14:00 KST |
| 작성자 | Claude |
| 버전 | v1.0.0 |
| 위치 | `C:/claude/claudeproject/bibleapp/docs/신규생성_전체성경데이터통합_20260103_1400.md` |

---

## 목차

1. [작업 개요](#1-작업-개요)
2. [데이터 현황](#2-데이터-현황)
3. [작업 내용](#3-작업-내용)
4. [생성된 파일](#4-생성된-파일)
5. [기술적 해결사항](#5-기술적-해결사항)
6. [확인 결과](#6-확인-결과)

---

## 1. 작업 개요

### 목표
- 개역한글 성경 전체 데이터(66권, 31,102절)를 앱에 통합
- 기존 샘플 데이터에서 전체 성경 데이터로 교체

### 데이터 소스
- 출처: foxcg.com/31 (개역한글 성경 텍스트 파일)
- 파일명: `개역한글 (1).txt`
- 인코딩: EUC-KR

---

## 2. 데이터 현황

### 전체 통계

| 구분 | 권수 | 장수 | 절수 |
|------|------|------|------|
| 구약 | 39권 | 929장 | 23,145절 |
| 신약 | 27권 | 260장 | 7,957절 |
| **합계** | **66권** | **1,189장** | **31,102절** |

### 구약 39권 상세

| # | 권명 | 장수 | 절수 |
|---|------|------|------|
| 1 | 창세기 | 50 | 1,533 |
| 2 | 출애굽기 | 40 | 1,213 |
| 3 | 레위기 | 27 | 859 |
| 4 | 민수기 | 36 | 1,288 |
| 5 | 신명기 | 34 | 959 |
| 6 | 여호수아 | 24 | 658 |
| 7 | 사사기 | 21 | 618 |
| 8 | 룻기 | 4 | 85 |
| 9 | 사무엘상 | 31 | 810 |
| 10 | 사무엘하 | 24 | 695 |
| 11 | 열왕기상 | 22 | 816 |
| 12 | 열왕기하 | 25 | 719 |
| 13 | 역대상 | 29 | 942 |
| 14 | 역대하 | 36 | 822 |
| 15 | 에스라 | 10 | 280 |
| 16 | 느헤미야 | 13 | 406 |
| 17 | 에스더 | 10 | 167 |
| 18 | 욥기 | 42 | 1,070 |
| 19 | 시편 | 150 | 2,460 |
| 20 | 잠언 | 31 | 915 |
| 21 | 전도서 | 12 | 222 |
| 22 | 아가 | 8 | 118 |
| 23 | 이사야 | 66 | 1,292 |
| 24 | 예레미야 | 52 | 1,364 |
| 25 | 예레미야애가 | 5 | 154 |
| 26 | 에스겔 | 48 | 1,273 |
| 27 | 다니엘 | 12 | 357 |
| 28 | 호세아 | 14 | 197 |
| 29 | 요엘 | 3 | 73 |
| 30 | 아모스 | 9 | 146 |
| 31 | 오바댜 | 1 | 21 |
| 32 | 요나 | 4 | 48 |
| 33 | 미가 | 7 | 105 |
| 34 | 나훔 | 3 | 47 |
| 35 | 하박국 | 3 | 56 |
| 36 | 스바냐 | 3 | 53 |
| 37 | 학개 | 2 | 38 |
| 38 | 스가랴 | 14 | 211 |
| 39 | 말라기 | 4 | 55 |

### 신약 27권 상세

| # | 권명 | 장수 | 절수 |
|---|------|------|------|
| 40 | 마태복음 | 28 | 1,071 |
| 41 | 마가복음 | 16 | 678 |
| 42 | 누가복음 | 24 | 1,151 |
| 43 | 요한복음 | 21 | 879 |
| 44 | 사도행전 | 28 | 1,007 |
| 45 | 로마서 | 16 | 433 |
| 46 | 고린도전서 | 16 | 437 |
| 47 | 고린도후서 | 13 | 256 |
| 48 | 갈라디아서 | 6 | 149 |
| 49 | 에베소서 | 6 | 155 |
| 50 | 빌립보서 | 4 | 104 |
| 51 | 골로새서 | 4 | 95 |
| 52 | 데살로니가전서 | 5 | 89 |
| 53 | 데살로니가후서 | 3 | 47 |
| 54 | 디모데전서 | 6 | 113 |
| 55 | 디모데후서 | 4 | 83 |
| 56 | 디도서 | 3 | 46 |
| 57 | 빌레몬서 | 1 | 25 |
| 58 | 히브리서 | 13 | 303 |
| 59 | 야고보서 | 5 | 108 |
| 60 | 베드로전서 | 5 | 105 |
| 61 | 베드로후서 | 3 | 61 |
| 62 | 요한일서 | 5 | 105 |
| 63 | 요한이서 | 1 | 13 |
| 64 | 요한삼서 | 1 | 15 |
| 65 | 유다서 | 1 | 25 |
| 66 | 요한계시록 | 22 | 404 |

---

## 3. 작업 내용

### 3.1 성경 메타데이터 생성

파일: `src/data/bibleMetadata.ts`

```typescript
export interface BookMetadata {
  bookId: number;
  bookCode: string;
  testament: 'OT' | 'NT';
  koreanName: string;
  koreanAbbrev: string;
  englishName: string;
  englishAbbrev: string;
  totalChapters: number;
  totalVerses: number;
  chaptersVerseCount: number[];
}
```

### 3.2 성경 파일 파싱 스크립트

파일: `scripts/parseBibleFile.js`

- EUC-KR 인코딩 처리 (iconv-lite 라이브러리)
- 정규식 파싱: `^(\d?[A-Za-z]+)\s+(\d+):(\d+)\s+(.+)$`
- 책 코드 매핑 (3글자 약어)

```javascript
const bookCodeMap = {
  // 구약
  'Gen': 1, 'Exo': 2, 'Lev': 3, 'Num': 4, 'Deu': 5,
  'Jos': 6, 'Jdg': 7, 'Rut': 8, '1Sa': 9, '2Sa': 10,
  '1Ki': 11, '2Ki': 12, '1Ch': 13, '2Ch': 14, 'Ezr': 15,
  'Neh': 16, 'Est': 17, 'Job': 18, 'Psa': 19, 'Pro': 20,
  'Ecc': 21, 'Sol': 22, 'Isa': 23, 'Jer': 24, 'Lam': 25,
  'Eze': 26, 'Dan': 27, 'Hos': 28, 'Joe': 29, 'Amo': 30,
  'Oba': 31, 'Jon': 32, 'Mic': 33, 'Nah': 34, 'Hab': 35,
  'Zep': 36, 'Hag': 37, 'Zec': 38, 'Mal': 39,
  // 신약
  'Mat': 40, 'Mar': 41, 'Luk': 42, 'Joh': 43, 'Act': 44,
  'Rom': 45, '1Co': 46, '2Co': 47, 'Gal': 48, 'Eph': 49,
  'Phi': 50, 'Col': 51, '1Th': 52, '2Th': 53, '1Ti': 54,
  '2Ti': 55, 'Tit': 56, 'Phm': 57, 'Heb': 58, 'Jam': 59,
  '1Pe': 60, '2Pe': 61, '1Jo': 62, '2Jo': 63, '3Jo': 64,
  'Jud': 65, 'Rev': 66
};
```

### 3.3 데이터베이스 로더 수정

파일: `src/services/database/index.ts`

```typescript
// JSON 성경 데이터 import
import otPart1 from '../../data/bible/ot_part1.json';
import otPart2 from '../../data/bible/ot_part2.json';
import ntData from '../../data/bible/nt.json';

// 전체 성경 데이터 병합
const allBibleVerses = [...otPart1, ...otPart2, ...ntData];
```

### 3.4 TypeScript 설정 수정

파일: `tsconfig.json`

```json
{
  "compilerOptions": {
    "resolveJsonModule": true,
    "esModuleInterop": true
  }
}
```

---

## 4. 생성된 파일

### JSON 데이터 파일

| 파일명 | 위치 | 설명 | 용량 |
|--------|------|------|------|
| `ot_part1.json` | `src/data/bible/` | 구약 Part1 (창세기-시편) | 16,400절 |
| `ot_part2.json` | `src/data/bible/` | 구약 Part2 (잠언-말라기) | 6,745절 |
| `nt.json` | `src/data/bible/` | 신약 전체 | 7,957절 |
| `stats.json` | `src/data/bible/` | 통계 정보 | - |

### 스크립트 파일

| 파일명 | 위치 | 설명 |
|--------|------|------|
| `parseBibleFile.js` | `scripts/` | EUC-KR 성경 파일 파싱 |
| `fetchBibleData.js` | `scripts/` | API 기반 데이터 수집 (미사용) |

### 수정된 파일

| 파일명 | 위치 | 변경 내용 |
|--------|------|----------|
| `index.ts` | `src/services/database/` | JSON import 및 로더 수정 |
| `tsconfig.json` | 프로젝트 루트 | JSON 모듈 지원 추가 |
| `bibleMetadata.ts` | `src/data/` | 66권 메타데이터 정의 |

---

## 5. 기술적 해결사항

### 5.1 EUC-KR 인코딩 문제

**문제**: 성경 텍스트 파일이 EUC-KR로 인코딩되어 있어 직접 읽으면 깨진 문자 출력

**해결**:
```javascript
const iconv = require('iconv-lite');
const buffer = fs.readFileSync(filePath);
const content = iconv.decode(buffer, 'euc-kr');
```

### 5.2 책 코드 매핑 불일치

**문제**: 초기 파싱에서 10,360절만 파싱됨 (31,102절 중)

**원인**: 파일의 책 코드와 스크립트의 매핑 불일치
- 파일: `Exo`, `Mat`, `Mar` (3글자)
- 스크립트: `Exod`, `Matt`, `Mark` (4글자 이상)

**해결**: 실제 파일에서 사용된 책 코드를 추출하여 매핑 수정

### 5.3 JSON import 오류

**문제**: TypeScript에서 JSON 파일 import 시 타입 오류

**해결**: `tsconfig.json`에 설정 추가
```json
"resolveJsonModule": true,
"esModuleInterop": true
```

---

## 6. 확인 결과

### 앱 로그 확인

```
LOG [DatabaseService] 데이터베이스 초기화 시작...
LOG [DatabaseService] verses 테이블 생성 완료
LOG [DatabaseService] 초기 데이터 삽입 시작... (31102개 구절)
LOG [DatabaseService] 31102절 삽입 완료
LOG [DatabaseService] 초기화 완료
```

### 데이터 검증

| 항목 | 예상 값 | 실제 값 | 결과 |
|------|---------|---------|------|
| 총 구절 수 | 31,102 | 31,102 | OK |
| 구약 구절 | 23,145 | 23,145 | OK |
| 신약 구절 | 7,957 | 7,957 | OK |
| 책 수 | 66 | 66 | OK |

---

## 참고사항

- 개역한글 성경은 대한성서공회 번역본 기준
- 장/절 번호는 표준 개역한글 체계 준수
- 향후 다른 번역본(개역개정, NIV 등) 추가 시 동일 구조 활용 가능
