# 검색 페이징 개선 작업

> 검색 결과 전체 개수 표시 및 페이징을 통한 메모리 최적화

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | 수정_검색페이징개선_20260128_1100.md |
| 카테고리 | 수정 |
| 생성일시 | 2026-01-28 11:00 KST |
| 작성자 | Claude Code |
| 버전 | v1.0.0 |
| 위치 | C:/claude/claudeproject/bibleapp/docs/수정_검색페이징개선_20260128_1100.md |

---

## 목차

1. [작업 개요](#1-작업-개요)
2. [문제점](#2-문제점)
3. [해결 방법](#3-해결-방법)
4. [dictionaryService 수정](#4-dictionaryservice-수정)
5. [SearchScreen 수정](#5-searchscreen-수정)
6. [수정 파일 목록](#6-수정-파일-목록)

---

## 1. 작업 개요

| 항목 | 내용 |
|------|------|
| 작업 단계 | 19단계 (검색 기능 고도화) |
| 작업 유형 | 기능 개선 / 성능 최적화 |
| 플랫폼 | Android / iOS |

### 작업 목적
- 검색 결과의 **전체 개수**를 사용자에게 명확히 표시
- **페이징**을 통해 메모리 부하 최소화
- 대용량 검색 결과도 안정적으로 처리

---

## 2. 문제점

### 2.1 기존 제한값

| 서비스 | 기존 제한 | 문제점 |
|--------|----------|--------|
| `searchStrong()` | 50개 하드코딩 | 전체 개수 알 수 없음 |
| `searchBibleDictionary()` | 50개 하드코딩 | 전체 개수 알 수 없음 |
| 성경 검색 | 이미 페이징 구현됨 | - |

### 2.2 사용자 경험 문제
- 검색 결과가 몇 건인지 알 수 없음
- "더 보기" 버튼이 있어도 전체 대비 현재 로드량 파악 불가

---

## 3. 해결 방법

### 3.1 설계 원칙
1. **전체 개수 먼저 조회** - 검색 시 전체 결과 수 먼저 파악
2. **페이징으로 데이터 로드** - 화면에 필요한 만큼만 로드
3. **진행 상황 표시** - "30/300건" 형식으로 현재 상태 표시

### 3.2 페이지 크기 설정

| 구분 | 페이지 크기 | 비고 |
|------|------------|------|
| 성경 검색 | 50건 | 기존 유지 |
| Strong's 사전 | 30건 | 신규 |
| 성경 사전 | 30건 | 신규 |

---

## 4. dictionaryService 수정

### 4.1 searchStrong 함수

**변경 전:**
```typescript
async searchStrong(query: string, lang?: 'H' | 'G'): Promise<StrongEntry[]> {
  // ... 검색 로직
  if (results.length >= 50) break;  // 하드코딩된 제한
  return results.slice(0, 50);
}
```

**변경 후:**
```typescript
/**
 * Strong's 검색 (원어, 음역, 의미로 검색)
 * @param query - 검색어
 * @param lang - 언어 ('H': 히브리어, 'G': 헬라어)
 * @param limit - 최대 결과 수 (0이면 제한 없음, 기본값 0)
 * @param offset - 시작 위치 (기본값 0)
 */
async searchStrong(
  query: string,
  lang?: 'H' | 'G',
  limit: number = 0,
  offset: number = 0
): Promise<StrongEntry[]> {
  // ... 검색 로직 (제한 없이 전체 검색)

  // 페이징 적용
  if (limit > 0) {
    return results.slice(offset, offset + limit);
  }
  return results;
}
```

### 4.2 searchBibleDictionary 함수

**변경 후:**
```typescript
/**
 * 성경 사전 검색
 * @param query - 검색어
 * @param limit - 최대 결과 수 (0이면 제한 없음, 기본값 0)
 * @param offset - 시작 위치 (기본값 0)
 */
async searchBibleDictionary(
  query: string,
  limit: number = 0,
  offset: number = 0
): Promise<DictEntry[]> {
  // ... 검색 로직

  // 페이징 적용
  if (limit > 0) {
    return results.slice(offset, offset + limit);
  }
  return results;
}
```

### 4.3 신규 함수 추가

```typescript
/**
 * Strong's 검색 결과 개수 조회
 */
async getStrongSearchCount(query: string, lang?: 'H' | 'G'): Promise<number> {
  const results = await this.searchStrong(query, lang, 0, 0);
  return results.length;
}

/**
 * 성경 사전 검색 결과 개수 조회
 */
async getDictSearchCount(query: string): Promise<number> {
  const results = await this.searchBibleDictionary(query, 0, 0);
  return results.length;
}
```

---

## 5. SearchScreen 수정

### 5.1 상태 변수 추가

```typescript
// 사전 전체 개수
const [totalDictCount, setTotalDictCount] = useState(0);
const [totalStrongCount, setTotalStrongCount] = useState(0);
const [isDictLoadingMore, setIsDictLoadingMore] = useState(false);

// 페이지 상태
const [dictPage, setDictPage] = useState(0);
const [strongPage, setStrongPage] = useState(0);
const DICT_PAGE_SIZE = 30;
```

### 5.2 검색 실행 로직 변경

```typescript
// 사전 검색 - 전체 개수 먼저 조회
const [dictCount, strongHCount, strongGCount] = await Promise.all([
  dictionaryService.getDictSearchCount(trimmedQuery),
  dictionaryService.getStrongSearchCount(trimmedQuery, 'H'),
  dictionaryService.getStrongSearchCount(trimmedQuery, 'G'),
]);

setTotalDictCount(dictCount);
setTotalStrongCount(strongHCount + strongGCount);

// 사전 첫 페이지 로드
const [dicResults, strongResults] = await Promise.all([
  dictionaryService.searchBibleDictionary(trimmedQuery, DICT_PAGE_SIZE, 0),
  dictionaryService.searchStrong(trimmedQuery, undefined, DICT_PAGE_SIZE, 0),
]);
```

### 5.3 더 보기 로직 변경

```typescript
const loadMoreDictResults = async () => {
  if (isDictLoadingMore) return;

  const hasMoreDict = dictResults.length < totalDictCount;
  const hasMoreStrong = strongResults.length < totalStrongCount;

  if (!hasMoreDict && !hasMoreStrong) return;

  setIsDictLoadingMore(true);

  try {
    // 성경 사전 더 로드
    if (hasMoreDict) {
      const nextDictPage = dictPage + 1;
      const moreDictResults = await dictionaryService.searchBibleDictionary(
        trimmedQuery,
        DICT_PAGE_SIZE,
        nextDictPage * DICT_PAGE_SIZE
      );
      setDictResults(prev => [...prev, ...moreDictResults]);
      setDictPage(nextDictPage);
    }

    // Strong's 사전 더 로드
    if (hasMoreStrong) {
      const nextStrongPage = strongPage + 1;
      const moreStrongResults = await dictionaryService.searchStrong(
        trimmedQuery,
        undefined,
        DICT_PAGE_SIZE,
        nextStrongPage * DICT_PAGE_SIZE
      );
      setStrongResults(prev => [...prev, ...moreStrongResults]);
      setStrongPage(nextStrongPage);
    }
  } finally {
    setIsDictLoadingMore(false);
  }
};
```

### 5.4 UI 변경

#### 탭 헤더

```
📖 성경 (1,234건)  |  📚 사전 (567건)
```

#### 성경 탭 결과 헤더

```
전체 1,234건 중 50건 표시 (요한복음)
```

#### 사전 탭 요약

```
전체 567건 (Strong's 300건, 성경사전 267건)

📜 Strong's 원어 사전 (30/300건)
[항목들...]

📕 성경 사전 (30/267건)
[항목들...]

[더 보기 (60 / 567건)]
```

---

## 6. 수정 파일 목록

| # | 파일 경로 | 변경 유형 | 설명 |
|---|----------|----------|------|
| 1 | `src/services/dictionaryService.ts` | 수정 | limit/offset 파라미터 추가, 개수 조회 함수 추가 |
| 2 | `src/screens/search/SearchScreen.tsx` | 수정 | 전체 개수 표시, 페이징 로직 개선, UI 개선 |

---

## 관련 문서

- [수정_화면기능개선_20260128_1000.md](./수정_화면기능개선_20260128_1000.md) - 19단계 화면 기능 고도화
- [신규생성_주석사전통합_20260126_0030.md](./신규생성_주석사전통합_20260126_0030.md) - 사전 데이터 통합

---

## 문서 업데이트 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 2026-01-28 11:00 | v1.0.0 | 최초 문서 생성 | Claude Code |
