# Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏÑ§Í≥Ñ (DATABASE.md)

## Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Íµ¨Ï°∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Î°úÏª¨ Ï†ÄÏû•ÏÜå Íµ¨Ï°∞                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ   üìÅ Documents/                                             ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ bible.db          (ÏùΩÍ∏∞Ï†ÑÏö©, ~25MB)               ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ languages        (Ïñ∏Ïñ¥ Î™©Î°ù)                     ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bibles           (ÏÑ±Í≤Ω Î≤ÑÏ†Ñ)                     ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ books            (ÏÑ±Í≤Ω Ï±Ö 66Í∂å)                  ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ book_names       (Îã§Íµ≠Ïñ¥ Ï±Ö Ïù¥Î¶Ñ)                ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ verses           (ÏÑ±Í≤Ω Íµ¨Ï†à + FTS Ïù∏Îç±Ïä§)        ‚îÇ
‚îÇ   ‚îÇ                                                         ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ user.db           (ÏùΩÍ∏∞/Ïì∞Í∏∞, Í∞ÄÎ≥Ä)               ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ memos            (Î¨µÏÉÅ Î©îÎ™®)                     ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ memo_tags        (Î©îÎ™® ÌÉúÍ∑∏)                     ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ memo_tag_map     (Î©îÎ™®-ÌÉúÍ∑∏ Ïó∞Í≤∞)                ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ bookmarks        (Î∂ÅÎßàÌÅ¨)                        ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ highlights       (ÌïòÏù¥ÎùºÏù¥Ìä∏)                    ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ settings         (Ïï± ÏÑ§Ï†ï)                       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ   üîê SecureStore (Keychain/Keystore)                       ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ password_hash        (ÎπÑÎ∞ÄÎ≤àÌò∏ Ìï¥Ïãú)                 ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ encryption_key       (AES ÏïîÌò∏Ìôî ÌÇ§)                 ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ biometric_enabled    (ÏÉùÏ≤¥Ïù∏Ïãù ÏÑ§Ï†ï)                 ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Bible.db Ïä§ÌÇ§Îßà (ÏùΩÍ∏∞Ï†ÑÏö©)

### languages ÌÖåÏù¥Î∏î

```sql
CREATE TABLE languages (
    lang_id     TEXT PRIMARY KEY,      -- 'ko', 'en', 'ja'
    lang_name   TEXT NOT NULL,         -- 'ÌïúÍµ≠Ïñ¥', 'English', 'Êó•Êú¨Ë™û'
    is_active   INTEGER DEFAULT 1      -- 1: ÌôúÏÑ±, 0: ÎπÑÌôúÏÑ±
);

-- Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞
INSERT INTO languages VALUES ('ko', 'ÌïúÍµ≠Ïñ¥', 1);
INSERT INTO languages VALUES ('en', 'English', 1);
INSERT INTO languages VALUES ('ja', 'Êó•Êú¨Ë™û', 1);
```

### bibles ÌÖåÏù¥Î∏î

```sql
CREATE TABLE bibles (
    bible_id      TEXT PRIMARY KEY,    -- 'KRV', 'NIV', 'KJV', 'JPN'
    lang_id       TEXT NOT NULL,       -- FK ‚Üí languages
    version_name  TEXT NOT NULL,       -- 'Í∞úÏó≠ÌïúÍ∏Ä', 'NIV', 'Âè£Ë™ûË®≥'
    version_abbr  TEXT NOT NULL,       -- 'Í∞úÏó≠', 'NIV', 'Âè£Ë™û'
    copyright     TEXT,                -- Ï†ÄÏûëÍ∂å Ï†ïÎ≥¥
    FOREIGN KEY (lang_id) REFERENCES languages(lang_id)
);

-- Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞
INSERT INTO bibles VALUES ('KRV', 'ko', 'Í∞úÏó≠ÌïúÍ∏Ä', 'Í∞úÏó≠', 'ÎåÄÌïúÏÑ±ÏÑúÍ≥µÌöå');
INSERT INTO bibles VALUES ('NIV', 'en', 'New International Version', 'NIV', 'Biblica');
INSERT INTO bibles VALUES ('KJV', 'en', 'King James Version', 'KJV', 'Public Domain');
INSERT INTO bibles VALUES ('JPN', 'ja', 'Âè£Ë™ûË®≥ËÅñÊõ∏', 'Âè£Ë™û', 'Public Domain');
```

### books ÌÖåÏù¥Î∏î

```sql
CREATE TABLE books (
    book_id         INTEGER PRIMARY KEY,  -- 1-66
    book_code       TEXT NOT NULL UNIQUE, -- 'GEN', 'EXO', ... 'REV'
    testament       TEXT NOT NULL,        -- 'OT' | 'NT'
    total_chapters  INTEGER NOT NULL      -- Ï¥ù Ïû• Ïàò
);

-- Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏòàÏãú
INSERT INTO books VALUES (1, 'GEN', 'OT', 50);   -- Ï∞ΩÏÑ∏Í∏∞
INSERT INTO books VALUES (2, 'EXO', 'OT', 40);   -- Ï∂úÏï†ÍµΩÍ∏∞
-- ... (66Í∂å Ï†ÑÏ≤¥)
INSERT INTO books VALUES (43, 'JHN', 'NT', 21);  -- ÏöîÌïúÎ≥µÏùå
INSERT INTO books VALUES (66, 'REV', 'NT', 22);  -- ÏöîÌïúÍ≥ÑÏãúÎ°ù
```

### book_names ÌÖåÏù¥Î∏î

```sql
CREATE TABLE book_names (
    book_id     INTEGER NOT NULL,      -- FK ‚Üí books
    lang_id     TEXT NOT NULL,         -- FK ‚Üí languages
    book_name   TEXT NOT NULL,         -- 'Ï∞ΩÏÑ∏Í∏∞', 'Genesis', 'Ââµ‰∏ñË®ò'
    abbrev      TEXT,                  -- 'Ï∞Ω', 'Gen', 'Ââµ'
    PRIMARY KEY (book_id, lang_id),
    FOREIGN KEY (book_id) REFERENCES books(book_id),
    FOREIGN KEY (lang_id) REFERENCES languages(lang_id)
);

-- Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏòàÏãú
INSERT INTO book_names VALUES (1, 'ko', 'Ï∞ΩÏÑ∏Í∏∞', 'Ï∞Ω');
INSERT INTO book_names VALUES (1, 'en', 'Genesis', 'Gen');
INSERT INTO book_names VALUES (1, 'ja', 'Ââµ‰∏ñË®ò', 'Ââµ');
INSERT INTO book_names VALUES (43, 'ko', 'ÏöîÌïúÎ≥µÏùå', 'Ïöî');
INSERT INTO book_names VALUES (43, 'en', 'John', 'Jhn');
INSERT INTO book_names VALUES (43, 'ja', '„É®„Éè„Éç„Å´„Çà„ÇãÁ¶èÈü≥Êõ∏', '„É®„Éè„Éç');
```

### verses ÌÖåÏù¥Î∏î

```sql
CREATE TABLE verses (
    verse_id    INTEGER PRIMARY KEY AUTOINCREMENT,
    bible_id    TEXT NOT NULL,         -- FK ‚Üí bibles
    book_id     INTEGER NOT NULL,      -- FK ‚Üí books
    chapter     INTEGER NOT NULL,      -- Ïû• Î≤àÌò∏
    verse_num   INTEGER NOT NULL,      -- Ï†à Î≤àÌò∏
    text        TEXT NOT NULL,         -- ÏÑ±Í≤Ω Î≥∏Î¨∏
    FOREIGN KEY (bible_id) REFERENCES bibles(bible_id),
    FOREIGN KEY (book_id) REFERENCES books(book_id)
);

-- Î≥µÌï© Ïù∏Îç±Ïä§ (Îπ†Î•∏ Ï°∞Ìöå)
CREATE INDEX idx_verses_lookup ON verses(bible_id, book_id, chapter);
CREATE INDEX idx_verses_bible_book ON verses(bible_id, book_id);

-- Ï†ÑÎ¨∏Í≤ÄÏÉâ(FTS) Ïù∏Îç±Ïä§
CREATE VIRTUAL TABLE verses_fts USING fts5(
    text,
    content='verses',
    content_rowid='verse_id'
);

-- FTS Ìä∏Î¶¨Í±∞ (ÏûêÎèô ÎèôÍ∏∞Ìôî)
CREATE TRIGGER verses_ai AFTER INSERT ON verses BEGIN
    INSERT INTO verses_fts(rowid, text) VALUES (new.verse_id, new.text);
END;
```

### ÏòàÏãú Îç∞Ïù¥ÌÑ∞ (ÏöîÌïúÎ≥µÏùå 3:16)

```sql
-- verse_idÎäî ÏûêÎèô ÏÉùÏÑ±
INSERT INTO verses (bible_id, book_id, chapter, verse_num, text) VALUES
('KRV', 43, 3, 16, 'ÌïòÎÇòÎãòÏù¥ ÏÑ∏ÏÉÅÏùÑ Ïù¥Ï≤òÎüº ÏÇ¨ÎûëÌïòÏÇ¨ ÎèÖÏÉùÏûêÎ•º Ï£ºÏÖ®ÏúºÎãà Ïù¥Îäî Í∑∏Î•º ÎØøÎäî ÏûêÎßàÎã§ Î©∏ÎßùÌïòÏßÄ ÏïäÍ≥† ÏòÅÏÉùÏùÑ ÏñªÍ≤å ÌïòÎ†§ ÌïòÏã¨Ïù¥Îùº'),
('NIV', 43, 3, 16, 'For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.'),
('JPN', 43, 3, 16, 'Á•û„ÅØ„Åù„ÅÆ„Å≤„Å®„ÇäÂ≠ê„ÇíË≥ú„Çè„Å£„Åü„Åª„Å©„Å´„ÄÅ„Åì„ÅÆ‰∏ñ„ÇíÊÑõ„Åó„Å¶‰∏ã„Åï„Å£„Åü„ÄÇ„Åù„Çå„ÅØÂæ°Â≠ê„Çí‰ø°„Åò„ÇãËÄÖ„Åå„Å≤„Å®„Çä„ÇÇÊªÖ„Å≥„Å™„ÅÑ„Åß„ÄÅÊ∞∏ÈÅ†„ÅÆÂëΩ„ÇíÂæó„Çã„Åü„ÇÅ„Åß„ÅÇ„Çã„ÄÇ');
```

---

## User.db Ïä§ÌÇ§Îßà (ÏùΩÍ∏∞/Ïì∞Í∏∞)

### memos ÌÖåÏù¥Î∏î

```sql
CREATE TABLE memos (
    memo_id       TEXT PRIMARY KEY,     -- UUID
    verse_id      INTEGER NOT NULL,     -- FK ‚Üí verses
    bible_id      TEXT NOT NULL,        -- ÏûëÏÑ± ÏãúÏ†ê ÏÑ±Í≤Ω Î≤ÑÏ†Ñ
    book_id       INTEGER NOT NULL,
    chapter       INTEGER NOT NULL,
    verse_num     INTEGER NOT NULL,
    content       TEXT NOT NULL,        -- ÏïîÌò∏ÌôîÎêú Î©îÎ™® ÎÇ¥Ïö©
    is_encrypted  INTEGER DEFAULT 1,    -- 1: ÏïîÌò∏ÌôîÎê®
    created_at    TEXT NOT NULL,        -- ISO 8601
    updated_at    TEXT NOT NULL,
    is_deleted    INTEGER DEFAULT 0     -- Soft delete
);

CREATE INDEX idx_memos_verse ON memos(bible_id, book_id, chapter, verse_num);
CREATE INDEX idx_memos_created ON memos(created_at);
CREATE INDEX idx_memos_deleted ON memos(is_deleted);
```

### memo_tags ÌÖåÏù¥Î∏î

```sql
CREATE TABLE memo_tags (
    tag_id      INTEGER PRIMARY KEY AUTOINCREMENT,
    tag_name    TEXT NOT NULL UNIQUE,
    color       TEXT DEFAULT '#3B82F6',  -- Hex color
    created_at  TEXT NOT NULL
);

-- Í∏∞Î≥∏ ÌÉúÍ∑∏
INSERT INTO memo_tags (tag_name, color, created_at) VALUES
('Í∞êÏÇ¨', '#22C55E', datetime('now')),
('Í∏∞ÎèÑ', '#8B5CF6', datetime('now')),
('Î¨µÏÉÅ', '#3B82F6', datetime('now')),
('ÏïîÏÜ°', '#F59E0B', datetime('now'));
```

### memo_tag_map ÌÖåÏù¥Î∏î

```sql
CREATE TABLE memo_tag_map (
    memo_id     TEXT NOT NULL,
    tag_id      INTEGER NOT NULL,
    PRIMARY KEY (memo_id, tag_id),
    FOREIGN KEY (memo_id) REFERENCES memos(memo_id),
    FOREIGN KEY (tag_id) REFERENCES memo_tags(tag_id)
);
```

### bookmarks ÌÖåÏù¥Î∏î

```sql
CREATE TABLE bookmarks (
    bookmark_id   TEXT PRIMARY KEY,     -- UUID
    bible_id      TEXT NOT NULL,
    book_id       INTEGER NOT NULL,
    chapter       INTEGER NOT NULL,
    verse_num     INTEGER,              -- NULLÏù¥Î©¥ Ïû• Ï†ÑÏ≤¥ Î∂ÅÎßàÌÅ¨
    title         TEXT,                 -- ÏÑ†ÌÉùÏ†Å Ï†úÎ™©
    created_at    TEXT NOT NULL
);

CREATE INDEX idx_bookmarks_verse ON bookmarks(bible_id, book_id, chapter);
```

### highlights ÌÖåÏù¥Î∏î

```sql
CREATE TABLE highlights (
    highlight_id  TEXT PRIMARY KEY,     -- UUID
    verse_id      INTEGER NOT NULL,
    bible_id      TEXT NOT NULL,
    book_id       INTEGER NOT NULL,
    chapter       INTEGER NOT NULL,
    verse_num     INTEGER NOT NULL,
    color         TEXT DEFAULT '#FBBF24', -- ÌïòÏù¥ÎùºÏù¥Ìä∏ ÏÉâÏÉÅ
    created_at    TEXT NOT NULL
);

CREATE INDEX idx_highlights_verse ON highlights(bible_id, book_id, chapter);
```

### settings ÌÖåÏù¥Î∏î

```sql
CREATE TABLE settings (
    key         TEXT PRIMARY KEY,
    value       TEXT NOT NULL,
    updated_at  TEXT NOT NULL
);

-- Í∏∞Î≥∏ ÏÑ§Ï†ï
INSERT INTO settings VALUES ('theme', 'light', datetime('now'));
INSERT INTO settings VALUES ('font_size', '16', datetime('now'));
INSERT INTO settings VALUES ('default_bible', 'KRV', datetime('now'));
INSERT INTO settings VALUES ('language', 'ko', datetime('now'));
INSERT INTO settings VALUES ('auto_lock_minutes', '5', datetime('now'));
```

---

## Ï£ºÏöî ÏøºÎ¶¨

### ÏÑ±Í≤Ω ÏùΩÍ∏∞

```typescript
// ÌäπÏ†ï Ïû• Ï†ÑÏ≤¥ Ï°∞Ìöå
const getChapter = `
  SELECT v.verse_id, v.verse_num, v.text,
         (SELECT COUNT(*) FROM memos m 
          WHERE m.verse_id = v.verse_id AND m.is_deleted = 0) as memo_count,
         (SELECT h.color FROM highlights h 
          WHERE h.verse_id = v.verse_id) as highlight_color
  FROM verses v
  WHERE v.bible_id = ? AND v.book_id = ? AND v.chapter = ?
  ORDER BY v.verse_num
`;

// ÏÇ¨Ïö©
const verses = await db.getAllAsync(getChapter, [bibleId, bookId, chapter]);
```

### ÏÑ±Í≤Ω Í≤ÄÏÉâ

```typescript
// Ï†ÑÎ¨∏ Í≤ÄÏÉâ (FTS5)
const searchVerses = `
  SELECT v.verse_id, v.bible_id, v.book_id, v.chapter, v.verse_num, v.text,
         bn.book_name
  FROM verses v
  JOIN verses_fts fts ON v.verse_id = fts.rowid
  JOIN book_names bn ON v.book_id = bn.book_id AND bn.lang_id = ?
  WHERE v.bible_id = ? AND verses_fts MATCH ?
  ORDER BY rank
  LIMIT 100
`;

// ÏÇ¨Ïö© (Ïòà: ÌïúÍ∏Ä ÏÑ±Í≤ΩÏóêÏÑú "ÏÇ¨Îûë" Í≤ÄÏÉâ)
const results = await db.getAllAsync(searchVerses, ['ko', 'KRV', 'ÏÇ¨Îûë']);
```

### Î©îÎ™® CRUD

```typescript
// Î©îÎ™® ÏÉùÏÑ±
const createMemo = `
  INSERT INTO memos (memo_id, verse_id, bible_id, book_id, chapter, verse_num, 
                     content, is_encrypted, created_at, updated_at)
  VALUES (?, ?, ?, ?, ?, ?, ?, 1, ?, ?)
`;

// Î©îÎ™® Ï°∞Ìöå (ÌäπÏ†ï Íµ¨Ï†à)
const getMemosByVerse = `
  SELECT m.*, GROUP_CONCAT(t.tag_name) as tags
  FROM memos m
  LEFT JOIN memo_tag_map mtm ON m.memo_id = mtm.memo_id
  LEFT JOIN memo_tags t ON mtm.tag_id = t.tag_id
  WHERE m.bible_id = ? AND m.book_id = ? AND m.chapter = ? AND m.verse_num = ?
    AND m.is_deleted = 0
  GROUP BY m.memo_id
  ORDER BY m.created_at DESC
`;

// Î©îÎ™® ÏàòÏ†ï
const updateMemo = `
  UPDATE memos 
  SET content = ?, updated_at = ?
  WHERE memo_id = ?
`;

// Î©îÎ™® ÏÇ≠Ï†ú (Soft Delete)
const deleteMemo = `
  UPDATE memos SET is_deleted = 1, updated_at = ? WHERE memo_id = ?
`;
```

### ÌÜµÍ≥Ñ/Î∂ÑÏÑù

```typescript
// ÏûêÏ£º Î¨µÏÉÅÌïú Íµ¨Ï†à TOP 10
const getTopVerses = `
  SELECT m.book_id, m.chapter, m.verse_num, bn.book_name,
         COUNT(*) as memo_count
  FROM memos m
  JOIN book_names bn ON m.book_id = bn.book_id AND bn.lang_id = ?
  WHERE m.is_deleted = 0
  GROUP BY m.book_id, m.chapter, m.verse_num
  ORDER BY memo_count DESC
  LIMIT 10
`;

// ÏùºÎ≥Ñ Î¨µÏÉÅ ÌÜµÍ≥Ñ (ÏµúÍ∑º 30Ïùº)
const getDailyStats = `
  SELECT DATE(created_at) as date, COUNT(*) as count
  FROM memos
  WHERE is_deleted = 0 
    AND created_at >= DATE('now', '-30 days')
  GROUP BY DATE(created_at)
  ORDER BY date DESC
`;

// ÏõîÎ≥Ñ Î¨µÏÉÅ ÌÜµÍ≥Ñ
const getMonthlyStats = `
  SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as count
  FROM memos
  WHERE is_deleted = 0
  GROUP BY strftime('%Y-%m', created_at)
  ORDER BY month DESC
  LIMIT 12
`;

// ÌäπÏ†ï Íµ¨Ï†àÏùò Î™®Îì† Î©îÎ™® (Ïòà: ÏöîÌïú 3:16 Í¥ÄÎ†® Î™®Îì† Î©îÎ™®)
const getMemosByReference = `
  SELECT m.*, bn.book_name
  FROM memos m
  JOIN book_names bn ON m.book_id = bn.book_id AND bn.lang_id = ?
  WHERE m.book_id = ? AND m.chapter = ? AND m.verse_num = ?
    AND m.is_deleted = 0
  ORDER BY m.created_at DESC
`;
```

---

## Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï¥àÍ∏∞Ìôî ÏΩîÎìú

```typescript
// src/services/database.ts

import * as SQLite from 'expo-sqlite';
import * as FileSystem from 'expo-file-system';
import { Asset } from 'expo-asset';

class DatabaseService {
  private bibleDb: SQLite.SQLiteDatabase | null = null;
  private userDb: SQLite.SQLiteDatabase | null = null;

  async initialize(): Promise<void> {
    await this.initBibleDb();
    await this.initUserDb();
  }

  private async initBibleDb(): Promise<void> {
    const dbPath = `${FileSystem.documentDirectory}SQLite/bible.db`;
    
    // AssetsÏóêÏÑú Î≥µÏÇ¨ (ÏµúÏ¥à 1Ìöå)
    const fileInfo = await FileSystem.getInfoAsync(dbPath);
    if (!fileInfo.exists) {
      await FileSystem.makeDirectoryAsync(
        `${FileSystem.documentDirectory}SQLite`,
        { intermediates: true }
      );
      
      const asset = Asset.fromModule(require('../../assets/database/bible.db'));
      await asset.downloadAsync();
      await FileSystem.copyAsync({
        from: asset.localUri!,
        to: dbPath
      });
    }
    
    this.bibleDb = await SQLite.openDatabaseAsync('bible.db');
  }

  private async initUserDb(): Promise<void> {
    this.userDb = await SQLite.openDatabaseAsync('user.db');
    
    // ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await this.userDb.execAsync(`
      CREATE TABLE IF NOT EXISTS memos (
        memo_id TEXT PRIMARY KEY,
        verse_id INTEGER NOT NULL,
        bible_id TEXT NOT NULL,
        book_id INTEGER NOT NULL,
        chapter INTEGER NOT NULL,
        verse_num INTEGER NOT NULL,
        content TEXT NOT NULL,
        is_encrypted INTEGER DEFAULT 1,
        created_at TEXT NOT NULL,
        updated_at TEXT NOT NULL,
        is_deleted INTEGER DEFAULT 0
      );
      
      CREATE TABLE IF NOT EXISTS memo_tags (
        tag_id INTEGER PRIMARY KEY AUTOINCREMENT,
        tag_name TEXT NOT NULL UNIQUE,
        color TEXT DEFAULT '#3B82F6',
        created_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS memo_tag_map (
        memo_id TEXT NOT NULL,
        tag_id INTEGER NOT NULL,
        PRIMARY KEY (memo_id, tag_id)
      );
      
      CREATE TABLE IF NOT EXISTS bookmarks (
        bookmark_id TEXT PRIMARY KEY,
        bible_id TEXT NOT NULL,
        book_id INTEGER NOT NULL,
        chapter INTEGER NOT NULL,
        verse_num INTEGER,
        title TEXT,
        created_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS highlights (
        highlight_id TEXT PRIMARY KEY,
        verse_id INTEGER NOT NULL,
        bible_id TEXT NOT NULL,
        book_id INTEGER NOT NULL,
        chapter INTEGER NOT NULL,
        verse_num INTEGER NOT NULL,
        color TEXT DEFAULT '#FBBF24',
        created_at TEXT NOT NULL
      );
      
      CREATE TABLE IF NOT EXISTS settings (
        key TEXT PRIMARY KEY,
        value TEXT NOT NULL,
        updated_at TEXT NOT NULL
      );
      
      CREATE INDEX IF NOT EXISTS idx_memos_verse 
        ON memos(bible_id, book_id, chapter, verse_num);
      CREATE INDEX IF NOT EXISTS idx_memos_created 
        ON memos(created_at);
    `);
  }

  getBibleDb(): SQLite.SQLiteDatabase {
    if (!this.bibleDb) throw new Error('Bible DB not initialized');
    return this.bibleDb;
  }

  getUserDb(): SQLite.SQLiteDatabase {
    if (!this.userDb) throw new Error('User DB not initialized');
    return this.userDb;
  }
}

export const databaseService = new DatabaseService();
```

---

## ÌÉÄÏûÖ Ï†ïÏùò

```typescript
// src/types/database.ts

export interface Language {
  lang_id: string;
  lang_name: string;
  is_active: number;
}

export interface Bible {
  bible_id: string;
  lang_id: string;
  version_name: string;
  version_abbr: string;
  copyright: string | null;
}

export interface Book {
  book_id: number;
  book_code: string;
  testament: 'OT' | 'NT';
  total_chapters: number;
}

export interface BookName {
  book_id: number;
  lang_id: string;
  book_name: string;
  abbrev: string | null;
}

export interface Verse {
  verse_id: number;
  bible_id: string;
  book_id: number;
  chapter: number;
  verse_num: number;
  text: string;
}

export interface VerseWithMeta extends Verse {
  memo_count: number;
  highlight_color: string | null;
  book_name?: string;
}

export interface Memo {
  memo_id: string;
  verse_id: number;
  bible_id: string;
  book_id: number;
  chapter: number;
  verse_num: number;
  content: string;
  is_encrypted: number;
  created_at: string;
  updated_at: string;
  is_deleted: number;
  tags?: string;
}

export interface MemoTag {
  tag_id: number;
  tag_name: string;
  color: string;
  created_at: string;
}

export interface Bookmark {
  bookmark_id: string;
  bible_id: string;
  book_id: number;
  chapter: number;
  verse_num: number | null;
  title: string | null;
  created_at: string;
}

export interface Highlight {
  highlight_id: string;
  verse_id: number;
  bible_id: string;
  book_id: number;
  chapter: number;
  verse_num: number;
  color: string;
  created_at: string;
}

export interface Setting {
  key: string;
  value: string;
  updated_at: string;
}

// ÌÜµÍ≥Ñ ÌÉÄÏûÖ
export interface TopVerse {
  book_id: number;
  chapter: number;
  verse_num: number;
  book_name: string;
  memo_count: number;
}

export interface DailyStat {
  date: string;
  count: number;
}

export interface MonthlyStat {
  month: string;
  count: number;
}
```
